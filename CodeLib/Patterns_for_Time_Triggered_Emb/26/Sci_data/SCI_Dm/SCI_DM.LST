C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 1   


C51 COMPILER V6.10, COMPILATION OF MODULE SCI_DM
OBJECT MODULE PLACED IN .\SCI_DM.OBJ
COMPILER INVOKED BY: C:\KEIL\C51\BIN\C51.EXE .\SCI_DM.C OPTIMIZE(6,SIZE) BROWSE DEBUG OBJECTEXTEND CODE LISTINCLUDE SYMB
                    -OLS

stmt level    source

   1          /*------------------------------------------------------------------*-
   2          
   3             SCI_Dm.c (v1.00)
   4          
   5            ------------------------------------------------------------------
   6          
   7             This is an implementation of SCI SCHEDULER (DATA) for 8051/52.
   8          
   9             --- See Chapter 26 ---
  10          
  11             *** MASTER NODE ***
  12          
  13             *** Uses T2 for timing, 16-bit auto reload ***
  14             *** 12 MHz oscillator -> 1 ms (precise) tick interval ***
  15          
  16             --- Assumes '1232' watchdog on Slave ---
  17          
  18          
  19             COPYRIGHT
  20             ---------
  21          
  22             This code is from the book:
  23          
  24             PATTERNS FOR TIME-TRIGGERED EMBEDDED SYSTEMS by Michael J. Pont 
  25             [Pearson Education, 2001; ISBN: 0-201-33138-1].
  26          
  27             This code is copyright (c) 2001 by Michael J. Pont.
  28           
  29             See book for copyright details and other information.
  30          
  31          -*------------------------------------------------------------------*/
  32          
  33          #include "Main.h"
   1      =1  /*------------------------------------------------------------------*-
   2      =1  
   3      =1     Main.H (v1.00)
   4      =1  
   5      =1    ------------------------------------------------------------------
   6      =1     
   7      =1     'Project Header' (see Chap 9) for project SCI_Dm (see Chap 26)
   8      =1  
   9      =1  
  10      =1     COPYRIGHT
  11      =1     ---------
  12      =1  
  13      =1     This code is from the book:
  14      =1  
  15      =1     PATTERNS FOR TIME-TRIGGERED EMBEDDED SYSTEMS by Michael J. Pont 
  16      =1     [Pearson Education, 2001; ISBN: 0-201-33138-1].
  17      =1  
  18      =1     This code is copyright (c) 2001 by Michael J. Pont.
  19      =1   
  20      =1     See book for copyright details and other information.
  21      =1  
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 2   

  22      =1  -*------------------------------------------------------------------*/
  23      =1  
  24      =1  #ifndef _MAIN_H
  25      =1  #define _MAIN_H
  26      =1  
  27      =1  //------------------------------------------------------------------
  28      =1  // WILL NEED TO EDIT THIS SECTION FOR EVERY PROJECT
  29      =1  //------------------------------------------------------------------
  30      =1  
  31      =1  // Must include the appropriate microcontroller header file here
  32      =1  #include <AT89x52.h>
   1      =2  /*--------------------------------------------------------------------------
   2      =2  AT89X52.H
   3      =2  
   4      =2  Header file for the low voltage Flash Atmel AT89C52 and AT89LV52.
   5      =2  Copyright (c) 1995-1996 Keil Software, Inc.  All rights reserved.
   6      =2  --------------------------------------------------------------------------*/
   7      =2  
   8      =2  #ifndef AT89X52_HEADER_FILE
   9      =2  #define AT89X52_HEADER_FILE 1
  10      =2  
  11      =2  /*------------------------------------------------
  12      =2  Byte Registers
  13      =2  ------------------------------------------------*/
  14      =2  sfr P0      = 0x80;
  15      =2  sfr SP      = 0x81;
  16      =2  sfr DPL     = 0x82;
  17      =2  sfr DPH     = 0x83;
  18      =2  sfr PCON    = 0x87;
  19      =2  sfr TCON    = 0x88;
  20      =2  sfr TMOD    = 0x89;
  21      =2  sfr TL0     = 0x8A;
  22      =2  sfr TL1     = 0x8B;
  23      =2  sfr TH0     = 0x8C;
  24      =2  sfr TH1     = 0x8D;
  25      =2  sfr P1      = 0x90;
  26      =2  sfr SCON    = 0x98;
  27      =2  sfr SBUF    = 0x99;
  28      =2  sfr P2      = 0xA0;
  29      =2  sfr IE      = 0xA8;
  30      =2  sfr P3      = 0xB0;
  31      =2  sfr IP      = 0xB8;
  32      =2  sfr T2CON   = 0xC8;
  33      =2  sfr T2MOD   = 0xC9;
  34      =2  sfr RCAP2L  = 0xCA;
  35      =2  sfr RCAP2H  = 0xCB;
  36      =2  sfr TL2     = 0xCC;
  37      =2  sfr TH2     = 0xCD;
  38      =2  sfr PSW     = 0xD0;
  39      =2  sfr ACC     = 0xE0;
  40      =2  sfr B       = 0xF0;
  41      =2  
  42      =2  /*------------------------------------------------
  43      =2  P0 Bit Registers
  44      =2  ------------------------------------------------*/
  45      =2  sbit P0_0 = 0x80;
  46      =2  sbit P0_1 = 0x81;
  47      =2  sbit P0_2 = 0x82;
  48      =2  sbit P0_3 = 0x83;
  49      =2  sbit P0_4 = 0x84;
  50      =2  sbit P0_5 = 0x85;
  51      =2  sbit P0_6 = 0x86;
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 3   

  52      =2  sbit P0_7 = 0x87;
  53      =2  
  54      =2  /*------------------------------------------------
  55      =2  PCON Bit Values
  56      =2  ------------------------------------------------*/
  57      =2  #define IDL_    0x01
  58      =2  
  59      =2  #define STOP_   0x02
  60      =2  #define PD_     0x02    /* Alternate definition */
  61      =2  
  62      =2  #define GF0_    0x04
  63      =2  #define GF1_    0x08
  64      =2  #define SMOD_   0x80
  65      =2  
  66      =2  /*------------------------------------------------
  67      =2  TCON Bit Registers
  68      =2  ------------------------------------------------*/
  69      =2  sbit IT0  = 0x88;
  70      =2  sbit IE0  = 0x89;
  71      =2  sbit IT1  = 0x8A;
  72      =2  sbit IE1  = 0x8B;
  73      =2  sbit TR0  = 0x8C;
  74      =2  sbit TF0  = 0x8D;
  75      =2  sbit TR1  = 0x8E;
  76      =2  sbit TF1  = 0x8F;
  77      =2  
  78      =2  /*------------------------------------------------
  79      =2  TMOD Bit Values
  80      =2  ------------------------------------------------*/
  81      =2  #define T0_M0_   0x01
  82      =2  #define T0_M1_   0x02
  83      =2  #define T0_CT_   0x04
  84      =2  #define T0_GATE_ 0x08
  85      =2  #define T1_M0_   0x10
  86      =2  #define T1_M1_   0x20
  87      =2  #define T1_CT_   0x40
  88      =2  #define T1_GATE_ 0x80
  89      =2  
  90      =2  #define T1_MASK_ 0xF0
  91      =2  #define T0_MASK_ 0x0F
  92      =2  
  93      =2  /*------------------------------------------------
  94      =2  P1 Bit Registers
  95      =2  ------------------------------------------------*/
  96      =2  sbit P1_0 = 0x90;
  97      =2  sbit P1_1 = 0x91;
  98      =2  sbit P1_2 = 0x92;
  99      =2  sbit P1_3 = 0x93;
 100      =2  sbit P1_4 = 0x94;
 101      =2  sbit P1_5 = 0x95;
 102      =2  sbit P1_6 = 0x96;
 103      =2  sbit P1_7 = 0x97;
 104      =2  
 105      =2  sbit T2   = 0x90;       /* External input to Timer/Counter 2, clock out */
 106      =2  sbit T2EX = 0x91;       /* Timer/Counter 2 capture/reload trigger & dir ctl */
 107      =2  
 108      =2  /*------------------------------------------------
 109      =2  SCON Bit Registers
 110      =2  ------------------------------------------------*/
 111      =2  sbit RI   = 0x98;
 112      =2  sbit TI   = 0x99;
 113      =2  sbit RB8  = 0x9A;
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 4   

 114      =2  sbit TB8  = 0x9B;
 115      =2  sbit REN  = 0x9C;
 116      =2  sbit SM2  = 0x9D;
 117      =2  sbit SM1  = 0x9E;
 118      =2  sbit SM0  = 0x9F;
 119      =2  
 120      =2  /*------------------------------------------------
 121      =2  P2 Bit Registers
 122      =2  ------------------------------------------------*/
 123      =2  sbit P2_0 = 0xA0;
 124      =2  sbit P2_1 = 0xA1;
 125      =2  sbit P2_2 = 0xA2;
 126      =2  sbit P2_3 = 0xA3;
 127      =2  sbit P2_4 = 0xA4;
 128      =2  sbit P2_5 = 0xA5;
 129      =2  sbit P2_6 = 0xA6;
 130      =2  sbit P2_7 = 0xA7;
 131      =2  
 132      =2  /*------------------------------------------------
 133      =2  IE Bit Registers
 134      =2  ------------------------------------------------*/
 135      =2  sbit EX0  = 0xA8;       /* 1=Enable External interrupt 0 */
 136      =2  sbit ET0  = 0xA9;       /* 1=Enable Timer 0 interrupt */
 137      =2  sbit EX1  = 0xAA;       /* 1=Enable External interrupt 1 */
 138      =2  sbit ET1  = 0xAB;       /* 1=Enable Timer 1 interrupt */
 139      =2  sbit ES   = 0xAC;       /* 1=Enable Serial port interrupt */
 140      =2  sbit ET2  = 0xAD;       /* 1=Enable Timer 2 interrupt */
 141      =2  
 142      =2  sbit EA   = 0xAF;       /* 0=Disable all interrupts */
 143      =2  
 144      =2  /*------------------------------------------------
 145      =2  P3 Bit Registers (Mnemonics & Ports)
 146      =2  ------------------------------------------------*/
 147      =2  sbit P3_0 = 0xB0;
 148      =2  sbit P3_1 = 0xB1;
 149      =2  sbit P3_2 = 0xB2;
 150      =2  sbit P3_3 = 0xB3;
 151      =2  sbit P3_4 = 0xB4;
 152      =2  sbit P3_5 = 0xB5;
 153      =2  sbit P3_6 = 0xB6;
 154      =2  sbit P3_7 = 0xB7;
 155      =2  
 156      =2  sbit RXD  = 0xB0;       /* Serial data input */
 157      =2  sbit TXD  = 0xB1;       /* Serial data output */
 158      =2  sbit INT0 = 0xB2;       /* External interrupt 0 */
 159      =2  sbit INT1 = 0xB3;       /* External interrupt 1 */
 160      =2  sbit T0   = 0xB4;       /* Timer 0 external input */
 161      =2  sbit T1   = 0xB5;       /* Timer 1 external input */
 162      =2  sbit WR   = 0xB6;       /* External data memory write strobe */
 163      =2  sbit RD   = 0xB7;       /* External data memory read strobe */
 164      =2  
 165      =2  /*------------------------------------------------
 166      =2  IP Bit Registers
 167      =2  ------------------------------------------------*/
 168      =2  sbit PX0  = 0xB8;
 169      =2  sbit PT0  = 0xB9;
 170      =2  sbit PX1  = 0xBA;
 171      =2  sbit PT1  = 0xBB;
 172      =2  sbit PS   = 0xBC;
 173      =2  sbit PT2  = 0xBD;
 174      =2  
 175      =2  /*------------------------------------------------
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 5   

 176      =2  T2CON Bit Registers
 177      =2  ------------------------------------------------*/
 178      =2  sbit CP_RL2= 0xC8;      /* 0=Reload, 1=Capture select */
 179      =2  sbit C_T2 = 0xC9;       /* 0=Timer, 1=Counter */
 180      =2  sbit TR2  = 0xCA;       /* 0=Stop timer, 1=Start timer */
 181      =2  sbit EXEN2= 0xCB;       /* Timer 2 external enable */
 182      =2  sbit TCLK = 0xCC;       /* 0=Serial clock uses Timer 1 overflow, 1=Timer 2 */
 183      =2  sbit RCLK = 0xCD;       /* 0=Serial clock uses Timer 1 overflow, 1=Timer 2 */
 184      =2  sbit EXF2 = 0xCE;       /* Timer 2 external flag */
 185      =2  sbit TF2  = 0xCF;       /* Timer 2 overflow flag */
 186      =2  
 187      =2  /*------------------------------------------------
 188      =2  T2MOD Bit Values
 189      =2  ------------------------------------------------*/
 190      =2  #define DCEN_   0x01    /* 1=Timer 2 can be configured as up/down counter */
 191      =2  #define T2OE_   0x02    /* Timer 2 output enable */
 192      =2  
 193      =2  /*------------------------------------------------
 194      =2  PSW Bit Registers
 195      =2  ------------------------------------------------*/
 196      =2  sbit P    = 0xD0;
 197      =2  sbit FL   = 0xD1;
 198      =2  sbit OV   = 0xD2;
 199      =2  sbit RS0  = 0xD3;
 200      =2  sbit RS1  = 0xD4;
 201      =2  sbit F0   = 0xD5;
 202      =2  sbit AC   = 0xD6;
 203      =2  sbit CY   = 0xD7;
 204      =2  
 205      =2  /*------------------------------------------------
 206      =2  Interrupt Vectors:
 207      =2  Interrupt Address = (Number * 8) + 3
 208      =2  ------------------------------------------------*/
 209      =2  #define IE0_VECTOR	0  /* 0x03 External Interrupt 0 */
 210      =2  #define TF0_VECTOR	1  /* 0x0B Timer 0 */
 211      =2  #define IE1_VECTOR	2  /* 0x13 External Interrupt 1 */
 212      =2  #define TF1_VECTOR	3  /* 0x1B Timer 1 */
 213      =2  #define SIO_VECTOR	4  /* 0x23 Serial port */
 214      =2  
 215      =2  #define TF2_VECTOR	5  /* 0x2B Timer 2 */
 216      =2  #define EX2_VECTOR	5  /* 0x2B External Interrupt 2 */
 217      =2  
 218      =2  /*------------------------------------------------
 219      =2  ------------------------------------------------*/
 220      =2  #endif
 221      =2  
 222      =2  
  33      =1  
  34      =1  // Include oscillator / chip details here 
  35      =1  // (essential if generic delays / timeouts are used)
  36      =1  //  -
  37      =1  // Oscillator / resonator frequency (in Hz) e.g. (11059200UL)
  38      =1  #define OSC_FREQ (12000000UL)
  39      =1  
  40      =1  // Number of oscillations per instruction (4, 6 or 12)
  41      =1  // 12 - Original 8051 / 8052 and numerous modern versions
  42      =1  //  6 - Various Infineon and Philips devices, etc.
  43      =1  //  4 - Dallas, etc.
  44      =1  //
  45      =1  // Take care with Dallas devices 
  46      =1  // - Timers default to *12* osc ticks unless CKCON is modified 
  47      =1  // - If using generic code on a Dallas device, use 12 here
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 6   

  48      =1  #define OSC_PER_INST (12)
  49      =1  
  50      =1  //------------------------------------------------------------------
  51      =1  // SHOULD NOT NEED TO EDIT THE SECTIONS BELOW
  52      =1  //------------------------------------------------------------------
  53      =1  typedef unsigned char tByte;
  54      =1  typedef unsigned int  tWord;
  55      =1  typedef unsigned long tLong;
  56      =1  
  57      =1  // Misc #defines
  58      =1  #ifndef TRUE
  59      =1  #define FALSE 0
  60      =1  #define TRUE (!FALSE)
  61      =1  #endif
  62      =1  
  63      =1  #define RETURN_NORMAL (bit) 0
  64      =1  #define RETURN_ERROR (bit) 1
  65      =1  
  66      =1  
  67      =1  //------------------------------------------------------------------
  68      =1  // Interrupts
  69      =1  // - see Chapter 13.  
  70      =1  //------------------------------------------------------------------
  71      =1  
  72      =1  // Generic 8051/52 timer interrupts (used in most schedulers)
  73      =1  #define INTERRUPT_Timer_0_Overflow 1
  74      =1  #define INTERRUPT_Timer_1_Overflow 3
  75      =1  #define INTERRUPT_Timer_2_Overflow 5
  76      =1  
  77      =1  // Additional interrupts (used in shared-clock schedulers)
  78      =1  #define INTERRUPT_EXTERNAL_0 0
  79      =1  #define INTERRUPT_EXTERNAL_1 2
  80      =1  #define INTERRUPT_UART_Rx_Tx 4
  81      =1  #define INTERRUPT_CAN_c515c 17
  82      =1  
  83      =1  //------------------------------------------------------------------
  84      =1  // Error codes 
  85      =1  // - see Chapter 14. 
  86      =1  //------------------------------------------------------------------
  87      =1  
  88      =1  #define ERROR_SCH_TOO_MANY_TASKS (1)
  89      =1  #define ERROR_SCH_CANNOT_DELETE_TASK (2)
  90      =1  
  91      =1  #define ERROR_SCH_WAITING_FOR_SLAVE_TO_ACK (3)
  92      =1  #define ERROR_SCH_WAITING_FOR_START_COMMAND_FROM_MASTER (3)
  93      =1  
  94      =1  #define ERROR_SCH_ONE_OR_MORE_SLAVES_DID_NOT_START (4)
  95      =1  #define ERROR_SCH_LOST_SLAVE (5)
  96      =1  
  97      =1  #define ERROR_SCH_CAN_BUS_ERROR (6)
  98      =1  
  99      =1  #define ERROR_I2C_WRITE_BYTE (10)
 100      =1  #define ERROR_I2C_READ_BYTE (11)
 101      =1  #define ERROR_I2C_WRITE_BYTE_AT24C64 (12)
 102      =1  #define ERROR_I2C_READ_BYTE_AT24C64 (13)
 103      =1  #define ERROR_I2C_DS1621 (14)
 104      =1  
 105      =1  #define ERROR_USART_TI (21)
 106      =1  #define ERROR_USART_WRITE_CHAR (22)
 107      =1  
 108      =1  #define ERROR_SPI_EXCHANGE_BYTES_TIMEOUT (31)
 109      =1  #define ERROR_SPI_X25_TIMEOUT (32)
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 7   

 110      =1  #define ERROR_SPI_MAX1110_TIMEOUT (33)
 111      =1  
 112      =1  #define ERROR_ADC_MAX150_TIMEOUT (44)
 113      =1  
 114      =1  #endif
 115      =1  
 116      =1  /*------------------------------------------------------------------*-
 117      =1    ---- END OF FILE -------------------------------------------------
 118      =1  -*------------------------------------------------------------------*/
  34          #include "Port.h"
   1      =1  /*------------------------------------------------------------------*-
   2      =1  
   3      =1     Port.H (v1.00)
   4      =1  
   5      =1    ------------------------------------------------------------------
   6      =1  
   7      =1    'Port Header' (see Chap 10) for the project SCI_DM (Chap 26)
   8      =1  
   9      =1  
  10      =1     COPYRIGHT
  11      =1     ---------
  12      =1  
  13      =1     This code is from the book:
  14      =1  
  15      =1     PATTERNS FOR TIME-TRIGGERED EMBEDDED SYSTEMS by Michael J. Pont 
  16      =1     [Pearson Education, 2001; ISBN: 0-201-33138-1].
  17      =1  
  18      =1     This code is copyright (c) 2001 by Michael J. Pont.
  19      =1   
  20      =1     See book for copyright details and other information.
  21      =1  
  22      =1  -*------------------------------------------------------------------*/
  23      =1  
  24      =1  // ------ Sch51.C ----------------------------------------
  25      =1  
  26      =1  // Comment this line out if error reporting is NOT required
  27      =1  #define SCH_REPORT_ERRORS
  28      =1  
  29      =1  #ifdef SCH_REPORT_ERRORS
  30      =1  // The port on which error codes will be displayed
  31      =1  // ONLY USED IF ERRORS ARE REPORTED
  32      =1  #define Error_port P3
  33      =1  
  34      =1  #endif
  35      =1  
  36      =1  // ------ SCI_DM.C -------------------------------------------------
  37      =1  
  38      =1  // This pin is wired to the interrupt input pin
  39      =1  // (usually Pin3.2) of the slave microcontroller
  40      =1  sbit Interrupt_output_pin = P2^7;
  41      =1  
  42      =1  // This pin is wired to the 'watchdog' pin on the slave
  43      =1  sbit Slave_watchdog_pin = P2^6;
  44      =1  
  45      =1  // This port is used to transfer data to / from the slave
  46      =1  #define SCI_transfer_port P0
  47      =1  
  48      =1  
  49      =1  // ------ TLight_B.C ----------------------------------------------
  50      =1  
  51      =1  sbit Red_light   = (P2^0);
  52      =1  sbit Amber_light = (P2^1);
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 8   

  53      =1  sbit Green_light = (P2^2);
  54      =1  
  55      =1  
  56      =1  // ------ LED_Flas.C -----------------------------------------------
  57      =1  
  58      =1  // For flashing LED
  59      =1  sbit LED_pin = P1^0;
  60      =1  
  61      =1  
  62      =1  /*------------------------------------------------------------------*-
  63      =1    ---- END OF FILE -------------------------------------------------
  64      =1  -*------------------------------------------------------------------*/
  65      =1  
  66      =1  
  67      =1  
  35          
  36          #include "SCI_Dm.H"
   1      =1  /*------------------------------------------------------------------*-
   2      =1    
   3      =1     SCI_Dm.H (v1.00)
   4      =1  
   5      =1    ------------------------------------------------------------------
   6      =1  
   7      =1     - see SCI_Dm.C for details
   8      =1  
   9      =1  
  10      =1     COPYRIGHT
  11      =1     ---------
  12      =1  
  13      =1     This code is from the book:
  14      =1  
  15      =1     PATTERNS FOR TIME-TRIGGERED EMBEDDED SYSTEMS by Michael J. Pont 
  16      =1     [Pearson Education, 2001; ISBN: 0-201-33138-1].
  17      =1  
  18      =1     This code is copyright (c) 2001 by Michael J. Pont.
  19      =1   
  20      =1     See book for copyright details and other information.
  21      =1  
  22      =1  -*------------------------------------------------------------------*/
  23      =1  
  24      =1  #include "Main.h"
   1      =2  /*------------------------------------------------------------------*-
   2      =2  
   3      =2     Main.H (v1.00)
   4      =2  
   5      =2    ------------------------------------------------------------------
   6      =2     
   7      =2     'Project Header' (see Chap 9) for project SCI_Dm (see Chap 26)
   8      =2  
   9      =2  
  10      =2     COPYRIGHT
  11      =2     ---------
  12      =2  
  13      =2     This code is from the book:
  14      =2  
  15      =2     PATTERNS FOR TIME-TRIGGERED EMBEDDED SYSTEMS by Michael J. Pont 
  16      =2     [Pearson Education, 2001; ISBN: 0-201-33138-1].
  17      =2  
  18      =2     This code is copyright (c) 2001 by Michael J. Pont.
  19      =2   
  20      =2     See book for copyright details and other information.
  21      =2  
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 9   

  22      =2  -*------------------------------------------------------------------*/
  23      =2  
  24      =2  #ifndef _MAIN_H
           =2 #define _MAIN_H
           =2 
           =2 //------------------------------------------------------------------
           =2 // WILL NEED TO EDIT THIS SECTION FOR EVERY PROJECT
           =2 //------------------------------------------------------------------
           =2 
           =2 // Must include the appropriate microcontroller header file here
           =2 #include <AT89x52.h>
           =2 
           =2 // Include oscillator / chip details here 
           =2 // (essential if generic delays / timeouts are used)
           =2 //  -
           =2 // Oscillator / resonator frequency (in Hz) e.g. (11059200UL)
           =2 #define OSC_FREQ (12000000UL)
           =2 
           =2 // Number of oscillations per instruction (4, 6 or 12)
           =2 // 12 - Original 8051 / 8052 and numerous modern versions
           =2 //  6 - Various Infineon and Philips devices, etc.
           =2 //  4 - Dallas, etc.
           =2 //
           =2 // Take care with Dallas devices 
           =2 // - Timers default to *12* osc ticks unless CKCON is modified 
           =2 // - If using generic code on a Dallas device, use 12 here
           =2 #define OSC_PER_INST (12)
           =2 
           =2 //------------------------------------------------------------------
           =2 // SHOULD NOT NEED TO EDIT THE SECTIONS BELOW
           =2 //------------------------------------------------------------------
           =2 typedef unsigned char tByte;
           =2 typedef unsigned int  tWord;
           =2 typedef unsigned long tLong;
           =2 
           =2 // Misc #defines
           =2 #ifndef TRUE
           =2 #define FALSE 0
           =2 #define TRUE (!FALSE)
           =2 #endif
           =2 
           =2 #define RETURN_NORMAL (bit) 0
           =2 #define RETURN_ERROR (bit) 1
           =2 
           =2 
           =2 //------------------------------------------------------------------
           =2 // Interrupts
           =2 // - see Chapter 13.  
           =2 //------------------------------------------------------------------
           =2 
           =2 // Generic 8051/52 timer interrupts (used in most schedulers)
           =2 #define INTERRUPT_Timer_0_Overflow 1
           =2 #define INTERRUPT_Timer_1_Overflow 3
           =2 #define INTERRUPT_Timer_2_Overflow 5
           =2 
           =2 // Additional interrupts (used in shared-clock schedulers)
           =2 #define INTERRUPT_EXTERNAL_0 0
           =2 #define INTERRUPT_EXTERNAL_1 2
           =2 #define INTERRUPT_UART_Rx_Tx 4
           =2 #define INTERRUPT_CAN_c515c 17
           =2 
           =2 //------------------------------------------------------------------
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 10  

           =2 // Error codes 
           =2 // - see Chapter 14. 
           =2 //------------------------------------------------------------------
           =2 
           =2 #define ERROR_SCH_TOO_MANY_TASKS (1)
           =2 #define ERROR_SCH_CANNOT_DELETE_TASK (2)
           =2 
           =2 #define ERROR_SCH_WAITING_FOR_SLAVE_TO_ACK (3)
           =2 #define ERROR_SCH_WAITING_FOR_START_COMMAND_FROM_MASTER (3)
           =2 
           =2 #define ERROR_SCH_ONE_OR_MORE_SLAVES_DID_NOT_START (4)
           =2 #define ERROR_SCH_LOST_SLAVE (5)
           =2 
           =2 #define ERROR_SCH_CAN_BUS_ERROR (6)
           =2 
           =2 #define ERROR_I2C_WRITE_BYTE (10)
           =2 #define ERROR_I2C_READ_BYTE (11)
           =2 #define ERROR_I2C_WRITE_BYTE_AT24C64 (12)
           =2 #define ERROR_I2C_READ_BYTE_AT24C64 (13)
           =2 #define ERROR_I2C_DS1621 (14)
           =2 
           =2 #define ERROR_USART_TI (21)
           =2 #define ERROR_USART_WRITE_CHAR (22)
           =2 
           =2 #define ERROR_SPI_EXCHANGE_BYTES_TIMEOUT (31)
           =2 #define ERROR_SPI_X25_TIMEOUT (32)
           =2 #define ERROR_SPI_MAX1110_TIMEOUT (33)
           =2 
           =2 #define ERROR_ADC_MAX150_TIMEOUT (44)
           =2 
           =2 #endif
 115      =2  
 116      =2  /*------------------------------------------------------------------*-
 117      =2    ---- END OF FILE -------------------------------------------------
 118      =2  -*------------------------------------------------------------------*/
  25      =1  #include "SCH51.H"
   1      =2  /*------------------------------------------------------------------*-
   2      =2    
   3      =2     SCH51.H (v1.00)
   4      =2  
   5      =2    ------------------------------------------------------------------
   6      =2  
   7      =2     - see SCH51.C for details
   8      =2  
   9      =2  
  10      =2     COPYRIGHT
  11      =2     ---------
  12      =2  
  13      =2     This code is from the book:
  14      =2  
  15      =2     PATTERNS FOR TIME-TRIGGERED EMBEDDED SYSTEMS by Michael J. Pont 
  16      =2     [Pearson Education, 2001; ISBN: 0-201-33138-1].
  17      =2  
  18      =2     This code is copyright (c) 2001 by Michael J. Pont.
  19      =2   
  20      =2     See book for copyright details and other information.
  21      =2  
  22      =2  -*------------------------------------------------------------------*/
  23      =2  
  24      =2  #ifndef _SCH51_H
  25      =2  #define _SCH51_H
  26      =2  
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 11  

  27      =2  #include "Main.h"
   1      =3  /*------------------------------------------------------------------*-
   2      =3  
   3      =3     Main.H (v1.00)
   4      =3  
   5      =3    ------------------------------------------------------------------
   6      =3     
   7      =3     'Project Header' (see Chap 9) for project SCI_Dm (see Chap 26)
   8      =3  
   9      =3  
  10      =3     COPYRIGHT
  11      =3     ---------
  12      =3  
  13      =3     This code is from the book:
  14      =3  
  15      =3     PATTERNS FOR TIME-TRIGGERED EMBEDDED SYSTEMS by Michael J. Pont 
  16      =3     [Pearson Education, 2001; ISBN: 0-201-33138-1].
  17      =3  
  18      =3     This code is copyright (c) 2001 by Michael J. Pont.
  19      =3   
  20      =3     See book for copyright details and other information.
  21      =3  
  22      =3  -*------------------------------------------------------------------*/
  23      =3  
  24      =3  #ifndef _MAIN_H
           =3 #define _MAIN_H
           =3 
           =3 //------------------------------------------------------------------
           =3 // WILL NEED TO EDIT THIS SECTION FOR EVERY PROJECT
           =3 //------------------------------------------------------------------
           =3 
           =3 // Must include the appropriate microcontroller header file here
           =3 #include <AT89x52.h>
           =3 
           =3 // Include oscillator / chip details here 
           =3 // (essential if generic delays / timeouts are used)
           =3 //  -
           =3 // Oscillator / resonator frequency (in Hz) e.g. (11059200UL)
           =3 #define OSC_FREQ (12000000UL)
           =3 
           =3 // Number of oscillations per instruction (4, 6 or 12)
           =3 // 12 - Original 8051 / 8052 and numerous modern versions
           =3 //  6 - Various Infineon and Philips devices, etc.
           =3 //  4 - Dallas, etc.
           =3 //
           =3 // Take care with Dallas devices 
           =3 // - Timers default to *12* osc ticks unless CKCON is modified 
           =3 // - If using generic code on a Dallas device, use 12 here
           =3 #define OSC_PER_INST (12)
           =3 
           =3 //------------------------------------------------------------------
           =3 // SHOULD NOT NEED TO EDIT THE SECTIONS BELOW
           =3 //------------------------------------------------------------------
           =3 typedef unsigned char tByte;
           =3 typedef unsigned int  tWord;
           =3 typedef unsigned long tLong;
           =3 
           =3 // Misc #defines
           =3 #ifndef TRUE
           =3 #define FALSE 0
           =3 #define TRUE (!FALSE)
           =3 #endif
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 12  

           =3 
           =3 #define RETURN_NORMAL (bit) 0
           =3 #define RETURN_ERROR (bit) 1
           =3 
           =3 
           =3 //------------------------------------------------------------------
           =3 // Interrupts
           =3 // - see Chapter 13.  
           =3 //------------------------------------------------------------------
           =3 
           =3 // Generic 8051/52 timer interrupts (used in most schedulers)
           =3 #define INTERRUPT_Timer_0_Overflow 1
           =3 #define INTERRUPT_Timer_1_Overflow 3
           =3 #define INTERRUPT_Timer_2_Overflow 5
           =3 
           =3 // Additional interrupts (used in shared-clock schedulers)
           =3 #define INTERRUPT_EXTERNAL_0 0
           =3 #define INTERRUPT_EXTERNAL_1 2
           =3 #define INTERRUPT_UART_Rx_Tx 4
           =3 #define INTERRUPT_CAN_c515c 17
           =3 
           =3 //------------------------------------------------------------------
           =3 // Error codes 
           =3 // - see Chapter 14. 
           =3 //------------------------------------------------------------------
           =3 
           =3 #define ERROR_SCH_TOO_MANY_TASKS (1)
           =3 #define ERROR_SCH_CANNOT_DELETE_TASK (2)
           =3 
           =3 #define ERROR_SCH_WAITING_FOR_SLAVE_TO_ACK (3)
           =3 #define ERROR_SCH_WAITING_FOR_START_COMMAND_FROM_MASTER (3)
           =3 
           =3 #define ERROR_SCH_ONE_OR_MORE_SLAVES_DID_NOT_START (4)
           =3 #define ERROR_SCH_LOST_SLAVE (5)
           =3 
           =3 #define ERROR_SCH_CAN_BUS_ERROR (6)
           =3 
           =3 #define ERROR_I2C_WRITE_BYTE (10)
           =3 #define ERROR_I2C_READ_BYTE (11)
           =3 #define ERROR_I2C_WRITE_BYTE_AT24C64 (12)
           =3 #define ERROR_I2C_READ_BYTE_AT24C64 (13)
           =3 #define ERROR_I2C_DS1621 (14)
           =3 
           =3 #define ERROR_USART_TI (21)
           =3 #define ERROR_USART_WRITE_CHAR (22)
           =3 
           =3 #define ERROR_SPI_EXCHANGE_BYTES_TIMEOUT (31)
           =3 #define ERROR_SPI_X25_TIMEOUT (32)
           =3 #define ERROR_SPI_MAX1110_TIMEOUT (33)
           =3 
           =3 #define ERROR_ADC_MAX150_TIMEOUT (44)
           =3 
           =3 #endif
 115      =3  
 116      =3  /*------------------------------------------------------------------*-
 117      =3    ---- END OF FILE -------------------------------------------------
 118      =3  -*------------------------------------------------------------------*/
  28      =2  
  29      =2  // ------ Public data type declarations ----------------------------
  30      =2  
  31      =2  // Store in DATA area, if possible, for rapid access  
  32      =2  // Total memory per task is 7 bytes
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 13  

  33      =2  typedef data struct 
  34      =2     {
  35      =2     // Pointer to the task (must be a 'void (void)' function)
  36      =2     void (code * pTask)(void);  
  37      =2  
  38      =2     // Delay (ticks) until the function will (next) be run
  39      =2     // - see SCH_Add_Task() for further details
  40      =2     tWord Delay;       
  41      =2  
  42      =2     // Interval (ticks) between subsequent runs.
  43      =2     // - see SCH_Add_Task() for further details
  44      =2     tWord Period;       
  45      =2  
  46      =2     // Incremented (by scheduler) when task is due to execute
  47      =2     tByte RunMe;       
  48      =2     } sTask; 
  49      =2  
  50      =2  // ------ Public function prototypes -------------------------------
  51      =2  
  52      =2  // Core scheduler functions
  53      =2  void  SCH_Dispatch_Tasks(void);
  54      =2  tByte SCH_Add_Task(void (code*) (void), const tWord, const tWord);  
  55      =2  bit   SCH_Delete_Task(const tByte);
  56      =2  void  SCH_Report_Status(void);
  57      =2  
  58      =2  // ------ Public constants -----------------------------------------
  59      =2  
  60      =2  // The maximum number of tasks required at any one time
  61      =2  // during the execution of the program
  62      =2  //
  63      =2  // MUST BE ADJUSTED FOR EACH NEW PROJECT
  64      =2  #define SCH_MAX_TASKS   (2)   
  65      =2   
  66      =2  #endif
  67      =2                                
  68      =2  /*------------------------------------------------------------------*-
  69      =2    ---- END OF FILE -------------------------------------------------
  70      =2  -*------------------------------------------------------------------*/
  71      =2  
  26      =1  
  27      =1  // ------ Public function prototypes -------------------------------
  28      =1  
  29      =1  void SCI_D_MASTER_Init_T2(void);
  30      =1  void SCI_D_MASTER_Start(void);
  31      =1  void SCI_D_MASTER_Enter_Safe_State(void) reentrant;
  32      =1                                
  33      =1  /*------------------------------------------------------------------*-
  34      =1    ---- END OF FILE -------------------------------------------------
  35      =1  -*------------------------------------------------------------------*/
  36      =1  
  37      =1  
  37          #include "Delay_T0.h"
   1      =1  /*------------------------------------------------------------------*-
   2      =1  
   3      =1     Delay_T0.H (v1.00)
   4      =1  
   5      =1    ------------------------------------------------------------------
   6      =1  
   7      =1     - See Delay_T0.C for details.
   8      =1  
   9      =1  
  10      =1     COPYRIGHT
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 14  

  11      =1     ---------
  12      =1  
  13      =1     This code is from the book:
  14      =1  
  15      =1     PATTERNS FOR TIME-TRIGGERED EMBEDDED SYSTEMS by Michael J. Pont 
  16      =1     [Pearson Education, 2001; ISBN: 0-201-33138-1].
  17      =1  
  18      =1     This code is copyright (c) 2001 by Michael J. Pont.
  19      =1   
  20      =1     See book for copyright details and other information.
  21      =1  
  22      =1  -*------------------------------------------------------------------*/
  23      =1  
  24      =1  // ------ Public function prototypes -------------------------------
  25      =1  
  26      =1  void Hardware_Delay_T0(const tWord);
  27      =1  
  28      =1  /*------------------------------------------------------------------*-
  29      =1    ---- END OF FILE -------------------------------------------------
  30      =1  -*------------------------------------------------------------------*/
  38          #include "TLight_B.h"
   1      =1  /*------------------------------------------------------------------*-
   2      =1  
   3      =1     TLight_B.H (v1.00)
   4      =1  
   5      =1    ------------------------------------------------------------------
   6      =1     
   7      =1     - See TLight_B.C for details.
   8      =1  
   9      =1  
  10      =1     COPYRIGHT
  11      =1     ---------
  12      =1  
  13      =1     This code is from the book:
  14      =1  
  15      =1     PATTERNS FOR TIME-TRIGGERED EMBEDDED SYSTEMS by Michael J. Pont 
  16      =1     [Pearson Education, 2001; ISBN: 0-201-33138-1].
  17      =1  
  18      =1     This code is copyright (c) 2001 by Michael J. Pont.
  19      =1   
  20      =1     See book for copyright details and other information.
  21      =1  
  22      =1  -*------------------------------------------------------------------*/
  23      =1  
  24      =1  // ------ Public data type declarations ----------------------------
  25      =1  
  26      =1  // Possible system states
  27      =1  typedef 
  28      =1  enum {RED, RED_AMBER, GREEN, AMBER, BULB_BLOWN} eLight_State;
  29      =1  
  30      =1  
  31      =1  // ------ Public constants -----------------------------------------
  32      =1  
  33      =1  #define MASTER 1
  34      =1  #define SLAVE 0
  35      =1  
  36      =1  // ------ Public function prototypes -------------------------------
  37      =1  
  38      =1  void TRAFFIC_LIGHTS_Init(void);
  39      =1  void TRAFFIC_LIGHTS_Update(void);
  40      =1  
  41      =1  void TRAFFIC_LIGHTS_Display_Safe_Output(void);
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 15  

  42      =1  
  43      =1  /*------------------------------------------------------------------*-
  44      =1    ---- END OF FILE -------------------------------------------------
  45      =1  -*------------------------------------------------------------------*/
  39          
  40          // ------ Public variable definitions ------------------------------
  41          
  42          tByte Tick_message_data_G = RETURN_NORMAL;  
  43          tByte Ack_message_data_G = RETURN_NORMAL;
  44          
  45          // Used to detect slave activity
  46          bit First_call_G;
  47          bit Watchdog_input_previous_G;
  48          
  49          // ------ Public variable declarations -----------------------------
  50          
  51          // The array of tasks (see Sch51.c)
  52          extern sTask SCH_tasks_G[SCH_MAX_TASKS];
  53          
  54          // The error code variable (see Sch51.c)
  55          extern tByte Error_code_G;
  56          
  57          // Used to reset system in event of slave error (see Main.C)
  58          extern bit System_reset_G;
  59          
  60          // ------ Private function prototypes ------------------------------
  61          
  62          static void SCI_D_MASTER_Send_Tick_Message(void);
  63          static bit  SCI_D_MASTER_Process_Ack(void);
  64          
  65          /*------------------------------------------------------------------*-
  66          
  67            SCI_D_MASTER_Init_T2()
  68          
  69            Scheduler initialisation function.  Prepares scheduler data 
  70            structures and sets up timer interrupts at required rate.
  71            You must call this function before using the scheduler.  
  72          
  73          -*------------------------------------------------------------------*/
  74          void SCI_D_MASTER_Init_T2(void) 
  75             {
  76   1         tByte i;
  77   1      
  78   1         // No interrupts (yet)
  79   1         EA = 0;
  80   1      
  81   1         // ------ Set up the scheduler ----------------------------------
  82   1         // Sort out the tasks
  83   1         for (i = 0; i < SCH_MAX_TASKS; i++) 
  84   1            {
  85   2            SCH_Delete_Task(i);
  86   2            }
  87   1      
  88   1         // Reset the global error variable
  89   1         // - SCH_Delete_Task() will generate an error code, 
  90   1         //   (because the task array is empty)
  91   1         Error_code_G = 0;
  92   1      
  93   1         // ------ Set up Timer 2 (begin) --------------------------------
  94   1         // Now set up Timer 2
  95   1         // 16-bit timer function with automatic reload
  96   1      
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 16  

  97   1         // Crystal is assumed to be 12 MHz
  98   1         // The Timer 2 resolution is 0.000001 seconds (1 µs)
  99   1         // The required Timer 2 overflow is 0.001 seconds (1 ms)
 100   1         // - this takes 1000 timer ticks
 101   1         // Reload value is 65536 - 1000 = 64536 (dec) = 0xFC18
 102   1      
 103   1         T2CON = 0x04;   // load Timer 2 control register
 104   1         T2MOD = 0x00;   // load Timer 2 mode register
 105   1      
 106   1         TH2    = 0xFC;  // load timer 2 high byte
 107   1         RCAP2H = 0xFC;  // load timer 2 reload capture reg, high byte
 108   1         TL2    = 0x18;  // load timer 2 low byte
 109   1         RCAP2L = 0x18;  // load timer 2 reload capture reg, low byte
 110   1         
 111   1         ET2   = 1;  // Timer 2 interrupt is enabled
 112   1      
 113   1         TR2   = 1;  // Start Timer 2
 114   1         // ------ Set up Timer 2 (end) ----------------------------------
 115   1         }
 116          
 117          /*------------------------------------------------------------------*-
 118          
 119            SCI_D_MASTER_Start()
 120          
 121            Starts the scheduler, by enabling interrupts.
 122          
 123            NOTE: Usually called after all regular tasks are added,
 124            to keep the tasks synchronised.
 125          
 126            NOTE: ONLY THE SCHEDULER INTERRUPT SHOULD BE ENABLED!!! 
 127           
 128          -*------------------------------------------------------------------*/
 129          void SCI_D_MASTER_Start(void) 
 130             {
 131   1         // Try to place system in 'safe' state at start or after errors
 132   1         SCI_D_MASTER_Enter_Safe_State();
 133   1      
 134   1         // Delay here to cause the slave to time out and reset
 135   1         // Adjust this delay to match the timeout periods on the slaves
 136   1         Hardware_Delay_T0(500);
 137   1      
 138   1         // Now send first tick to start the slave
 139   1         // (starts on falling edge)
 140   1         Interrupt_output_pin = 1;
 141   1         Hardware_Delay_T0(5);
 142   1         Interrupt_output_pin = 0;
 143   1         Hardware_Delay_T0(5);
 144   1      
 145   1         Interrupt_output_pin = 1; // Ready for first tick
 146   1      
 147   1         // Start the scheduler
 148   1         EA = 1;
 149   1         }
 150          
 151          /*------------------------------------------------------------------*-
 152          
 153            SCI_D_MASTER_Update_T2
 154          
 155            This is the scheduler ISR.  It is called at a rate determined by 
 156            the timer settings in SCI_D_MASTER_Init_T2().  This version is 
 157            triggered by Timer 2 interrupts: timer is automatically reloaded.
 158          
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 17  

 159          -*------------------------------------------------------------------*/
 160          void SCI_D_MASTER_Update_T2(void) interrupt INTERRUPT_Timer_2_Overflow  
 161             {
 162   1         tByte Index;
 163   1      
 164   1         TF2 = 0; // Must manually clear this. 
 165   1      
 166   1         // Get the ack message from the slave
 167   1         if (SCI_D_MASTER_Process_Ack() == RETURN_ERROR)
 168   1            {
 169   2            // Did not receive ack!
 170   2            Error_code_G = ERROR_SCH_LOST_SLAVE;
 171   2      
 172   2            // Enter safe state and remain here until reset
 173   2            SCI_D_MASTER_Enter_Safe_State();
 174   2            while(1); 
 175   2            }
 176   1       
 177   1         // Send 'tick' message to the slave
 178   1         SCI_D_MASTER_Send_Tick_Message(); 
 179   1      
 180   1         // NOTE: calculations are in *TICKS* (not milliseconds)
 181   1         for (Index = 0; Index < SCH_MAX_TASKS; Index++)
 182   1            {
 183   2            // Check if there is a task at this location
 184   2            if (SCH_tasks_G[Index].pTask)
 185   2               {
 186   3               if (SCH_tasks_G[Index].Delay == 0)
 187   3                  {
 188   4                  // The task is due to run
 189   4                  SCH_tasks_G[Index].RunMe += 1;  // Increment the run flag
 190   4      
 191   4                  if (SCH_tasks_G[Index].Period)
 192   4                     {
 193   5                     // Schedule this periodic task to run again
 194   5                     SCH_tasks_G[Index].Delay = SCH_tasks_G[Index].Period;
 195   5                     }
 196   4                  }
 197   3               else
 198   3                  {
 199   4                  // Not yet ready to run: just decrement the delay 
 200   4                  SCH_tasks_G[Index].Delay -= 1;
 201   4                  }
 202   3               }         
 203   2            }
 204   1      
 205   1         // Prepare for next tick
 206   1         Interrupt_output_pin = 1;
 207   1         }   
 208          
 209          /*------------------------------------------------------------------*-
 210          
 211            SCI_D_MASTER_Send_Tick_Message()
 212          
 213            This function sends a tick message.
 214          
 215            The receipt of this message will cause an interrupt to be generated
 216            in the slave(s): this will, in turn, invoke the scheduler 'update' 
 217            function in the slave(s).
 218          
 219          -*------------------------------------------------------------------*/
 220          void SCI_D_MASTER_Send_Tick_Message(void) 
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 18  

 221             {
 222   1         // Apply the tick data to the port
 223   1         SCI_transfer_port = Tick_message_data_G;
 224   1      
 225   1         // Send tick (falling edge) to the slave
 226   1         Interrupt_output_pin = 0;
 227   1         }
 228          
 229          
 230          /*------------------------------------------------------------------*-
 231          
 232            SCI_D_MASTER_Process_Ack()
 233          
 234            Checks that the slave is operating.
 235          
 236            Reads data from the slave.
 237          
 238          -*------------------------------------------------------------------*/
 239          
 240          bit SCI_D_MASTER_Process_Ack(void) 
 241             {
 242   1         if (First_call_G)
 243   1            {
 244   2            // This is the first time this function has been called
 245   2            First_call_G = 0;
 246   2      
 247   2            // Prepare for subsequent checking of the watchdog pin
 248   2            Watchdog_input_previous_G = Slave_watchdog_pin;
 249   2            }
 250   1         else
 251   1            {
 252   2            // Watchdog pin should change state every time
 253   2            // - if the slave is running correctly
 254   2            if (Watchdog_input_previous_G == Slave_watchdog_pin)
 255   2               {
 256   3               // Error!
 257   3               return RETURN_ERROR;
 258   3               }
 259   2      
 260   2            // Slave is OK
 261   2            Watchdog_input_previous_G = Slave_watchdog_pin;
 262   2            }
 263   1      
 264   1         // Set up port for reading
 265   1         SCI_transfer_port = 0xFF;
 266   1      
 267   1         // Read ack message
 268   1         Ack_message_data_G = SCI_transfer_port;
 269   1      
 270   1         return RETURN_NORMAL;
 271   1         }
 272          
 273          /*------------------------------------------------------------------*-
 274          
 275            SCI_D_MASTER_Enter_Safe_State()
 276          
 277            This is the state entered by the system when:
 278            (1) The node is powered up or reset
 279            (2) The slave node fails
 280            (3) The network has an error
 281            (4) Ack messages are delayed for any other reason
 282          
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 19  

 283            Try to ensure that the system is in a 'safe' state in these 
 284            circumstances.
 285          
 286          -*------------------------------------------------------------------*/
 287          void SCI_D_MASTER_Enter_Safe_State(void) reentrant
 288             {
 289   1         // USER DEFINED - Edit as required
 290   1      
 291   1         // Here we display a safe output
 292   1         TRAFFIC_LIGHTS_Display_Safe_Output();
 293   1         }  
 294          
 295          /*------------------------------------------------------------------*-
 296            ---- END OF FILE -------------------------------------------------
 297          -*------------------------------------------------------------------*/
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 20  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION SCI_D_MASTER_Init_T2 (BEGIN)
                                           ; SOURCE LINE # 74
                                           ; SOURCE LINE # 75
                                           ; SOURCE LINE # 79
0000 C2AF              CLR     EA
                                           ; SOURCE LINE # 83
0002 E4                CLR     A
0003 F500        R     MOV     i,A
0005         ?C0001:
                                           ; SOURCE LINE # 84
                                           ; SOURCE LINE # 85
0005 AF00        R     MOV     R7,i
0007 120000      E     LCALL   _SCH_Delete_Task
                                           ; SOURCE LINE # 86
000A 0500        R     INC     i
000C E500        R     MOV     A,i
000E C3                CLR     C
000F 9402              SUBB    A,#02H
0011 40F2              JC      ?C0001
0013         ?C0002:
                                           ; SOURCE LINE # 91
0013 E4                CLR     A
0014 F500        E     MOV     Error_code_G,A
                                           ; SOURCE LINE # 103
0016 75C804            MOV     T2CON,#04H
                                           ; SOURCE LINE # 104
0019 F5C9              MOV     T2MOD,A
                                           ; SOURCE LINE # 106
001B 75CDFC            MOV     TH2,#0FCH
                                           ; SOURCE LINE # 107
001E 75CBFC            MOV     RCAP2H,#0FCH
                                           ; SOURCE LINE # 108
0021 75CC18            MOV     TL2,#018H
                                           ; SOURCE LINE # 109
0024 75CA18            MOV     RCAP2L,#018H
                                           ; SOURCE LINE # 111
0027 D2AD              SETB    ET2
                                           ; SOURCE LINE # 113
0029 D2CA              SETB    TR2
                                           ; SOURCE LINE # 115
002B 22                RET     
             ; FUNCTION SCI_D_MASTER_Init_T2 (END)

             ; FUNCTION SCI_D_MASTER_Start (BEGIN)
                                           ; SOURCE LINE # 129
                                           ; SOURCE LINE # 130
                                           ; SOURCE LINE # 132
0000 120000      R     LCALL   _?SCI_D_MASTER_Enter_Safe_State
                                           ; SOURCE LINE # 136
0003 7FF4              MOV     R7,#0F4H
0005 7E01              MOV     R6,#01H
0007 120000      E     LCALL   _Hardware_Delay_T0
                                           ; SOURCE LINE # 140
000A D2A7              SETB    Interrupt_output_pin
                                           ; SOURCE LINE # 141
000C 7F05              MOV     R7,#05H
000E 7E00              MOV     R6,#00H
0010 120000      E     LCALL   _Hardware_Delay_T0
                                           ; SOURCE LINE # 142
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 21  

0013 C2A7              CLR     Interrupt_output_pin
                                           ; SOURCE LINE # 143
0015 7F05              MOV     R7,#05H
0017 7E00              MOV     R6,#00H
0019 120000      E     LCALL   _Hardware_Delay_T0
                                           ; SOURCE LINE # 145
001C D2A7              SETB    Interrupt_output_pin
                                           ; SOURCE LINE # 148
001E D2AF              SETB    EA
                                           ; SOURCE LINE # 149
0020 22                RET     
             ; FUNCTION SCI_D_MASTER_Start (END)

             ; FUNCTION SCI_D_MASTER_Update_T2 (BEGIN)
0000 C0E0              PUSH    ACC
0002 C0F0              PUSH    B
0004 C083              PUSH    DPH
0006 C082              PUSH    DPL
0008 C0D0              PUSH    PSW
000A 75D000            MOV     PSW,#00H
000D C000              PUSH    AR0
000F C001              PUSH    AR1
0011 C002              PUSH    AR2
0013 C003              PUSH    AR3
0015 C004              PUSH    AR4
0017 C005              PUSH    AR5
0019 C006              PUSH    AR6
001B C007              PUSH    AR7
                                           ; SOURCE LINE # 160
                                           ; SOURCE LINE # 164
001D C2CF              CLR     TF2
                                           ; SOURCE LINE # 167
001F 120000      R     LCALL   SCI_D_MASTER_Process_Ack
0022 5008              JNC     ?C0006
                                           ; SOURCE LINE # 168
                                           ; SOURCE LINE # 170
0024 750005      E     MOV     Error_code_G,#05H
                                           ; SOURCE LINE # 173
0027 120000      R     LCALL   _?SCI_D_MASTER_Enter_Safe_State
002A         ?C0007:
                                           ; SOURCE LINE # 174
002A 80FE              SJMP    ?C0007
                                           ; SOURCE LINE # 175
002C         ?C0006:
                                           ; SOURCE LINE # 178
002C 120000      R     LCALL   SCI_D_MASTER_Send_Tick_Message
                                           ; SOURCE LINE # 181
;---- Variable 'Index' assigned to Register 'R7' ----
002F E4                CLR     A
0030 FF                MOV     R7,A
0031         ?C0009:
                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 184
0031 EF                MOV     A,R7
0032 75F007            MOV     B,#07H
0035 A4                MUL     AB
0036 2400        E     ADD     A,#LOW SCH_tasks_G
0038 F8                MOV     R0,A
0039 E6                MOV     A,@R0
003A FC                MOV     R4,A
003B 08                INC     R0
003C E6                MOV     A,@R0
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 22  

003D 4C                ORL     A,R4
003E 6046              JZ      ?C0011
                                           ; SOURCE LINE # 185
                                           ; SOURCE LINE # 186
0040 EF                MOV     A,R7
0041 75F007            MOV     B,#07H
0044 A4                MUL     AB
0045 2400        E     ADD     A,#LOW SCH_tasks_G+02H
0047 F8                MOV     R0,A
0048 E6                MOV     A,@R0
0049 FC                MOV     R4,A
004A 08                INC     R0
004B E6                MOV     A,@R0
004C 4C                ORL     A,R4
004D 7028              JNZ     ?C0013
                                           ; SOURCE LINE # 187
                                           ; SOURCE LINE # 189
004F EF                MOV     A,R7
0050 75F007            MOV     B,#07H
0053 A4                MUL     AB
0054 2400        E     ADD     A,#LOW SCH_tasks_G+06H
0056 F8                MOV     R0,A
0057 06                INC     @R0
                                           ; SOURCE LINE # 191
0058 EF                MOV     A,R7
0059 75F007            MOV     B,#07H
005C A4                MUL     AB
005D 2400        E     ADD     A,#LOW SCH_tasks_G+04H
005F F8                MOV     R0,A
0060 E6                MOV     A,@R0
0061 FC                MOV     R4,A
0062 08                INC     R0
0063 E6                MOV     A,@R0
0064 FD                MOV     R5,A
0065 4C                ORL     A,R4
0066 601E              JZ      ?C0011
                                           ; SOURCE LINE # 192
                                           ; SOURCE LINE # 194
0068 EF                MOV     A,R7
0069 75F007            MOV     B,#07H
006C A4                MUL     AB
006D 2400        E     ADD     A,#LOW SCH_tasks_G+02H
006F F8                MOV     R0,A
0070 A604              MOV     @R0,AR4
0072 08                INC     R0
0073 A605              MOV     @R0,AR5
                                           ; SOURCE LINE # 195
                                           ; SOURCE LINE # 196
0075 800F              SJMP    ?C0011
0077         ?C0013:
                                           ; SOURCE LINE # 198
                                           ; SOURCE LINE # 200
0077 EF                MOV     A,R7
0078 75F007            MOV     B,#07H
007B A4                MUL     AB
007C 2400        E     ADD     A,#LOW SCH_tasks_G+02H
007E F8                MOV     R0,A
007F 08                INC     R0
0080 E6                MOV     A,@R0
0081 16                DEC     @R0
0082 7002              JNZ     ?C0023
0084 18                DEC     R0
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 23  

0085 16                DEC     @R0
0086         ?C0023:
                                           ; SOURCE LINE # 201
                                           ; SOURCE LINE # 202
                                           ; SOURCE LINE # 203
0086         ?C0011:
0086 0F                INC     R7
0087 BF02A7            CJNE    R7,#02H,?C0009
008A         ?C0010:
                                           ; SOURCE LINE # 206
008A D2A7              SETB    Interrupt_output_pin
                                           ; SOURCE LINE # 207
008C D007              POP     AR7
008E D006              POP     AR6
0090 D005              POP     AR5
0092 D004              POP     AR4
0094 D003              POP     AR3
0096 D002              POP     AR2
0098 D001              POP     AR1
009A D000              POP     AR0
009C D0D0              POP     PSW
009E D082              POP     DPL
00A0 D083              POP     DPH
00A2 D0F0              POP     B
00A4 D0E0              POP     ACC
00A6 32                RETI    
             ; FUNCTION SCI_D_MASTER_Update_T2 (END)

             ; FUNCTION SCI_D_MASTER_Send_Tick_Message (BEGIN)
                                           ; SOURCE LINE # 220
                                           ; SOURCE LINE # 221
                                           ; SOURCE LINE # 223
0000 850080      R     MOV     P0,Tick_message_data_G
                                           ; SOURCE LINE # 226
0003 C2A7              CLR     Interrupt_output_pin
                                           ; SOURCE LINE # 227
0005 22                RET     
             ; FUNCTION SCI_D_MASTER_Send_Tick_Message (END)

             ; FUNCTION SCI_D_MASTER_Process_Ack (BEGIN)
                                           ; SOURCE LINE # 240
                                           ; SOURCE LINE # 241
                                           ; SOURCE LINE # 242
0000 300008      R     JNB     First_call_G,?C0018
                                           ; SOURCE LINE # 243
                                           ; SOURCE LINE # 245
0003 C200        R     CLR     First_call_G
                                           ; SOURCE LINE # 248
0005 A2A6              MOV     C,Slave_watchdog_pin
0007 9200        R     MOV     Watchdog_input_previous_G,C
                                           ; SOURCE LINE # 249
0009 800E              SJMP    ?C0019
000B         ?C0018:
                                           ; SOURCE LINE # 251
                                           ; SOURCE LINE # 254
000B A200        R     MOV     C,Watchdog_input_previous_G
000D 30A601            JNB     Slave_watchdog_pin,?C0024
0010 B3                CPL     C
0011         ?C0024:
0011 4002              JC      ?C0020
                                           ; SOURCE LINE # 255
                                           ; SOURCE LINE # 257
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 24  

0013 D3                SETB    C
0014 22                RET     
                                           ; SOURCE LINE # 258
0015         ?C0020:
                                           ; SOURCE LINE # 261
0015 A2A6              MOV     C,Slave_watchdog_pin
0017 9200        R     MOV     Watchdog_input_previous_G,C
                                           ; SOURCE LINE # 262
0019         ?C0019:
                                           ; SOURCE LINE # 265
0019 7580FF            MOV     P0,#0FFH
                                           ; SOURCE LINE # 268
001C 858000      R     MOV     Ack_message_data_G,P0
                                           ; SOURCE LINE # 270
001F C3                CLR     C
                                           ; SOURCE LINE # 271
0020         ?C0021:
0020 22                RET     
             ; FUNCTION SCI_D_MASTER_Process_Ack (END)

             ; FUNCTION _?SCI_D_MASTER_Enter_Safe_State (BEGIN)
                                           ; SOURCE LINE # 287
                                           ; SOURCE LINE # 292
0000 120000      E     LCALL   TRAFFIC_LIGHTS_Display_Safe_Outp
                                           ; SOURCE LINE # 293
0003 22                RET     
             ; FUNCTION _?SCI_D_MASTER_Enter_Safe_State (END)

C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 25  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


Ack_message_data_G . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0000H  1
LED_pin. . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0090H  1
P0 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0080H  1
P1 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0090H  1
P2 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A0H  1
AC . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D6H  1
T0 . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B4H  1
T1 . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B5H  1
EA . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00AFH  1
T2 . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0090H  1
tLong. . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_LONG   -----  4
sTask. . . . . . . . . . . . . . . . .  TYPEDEF  DATA   STRUCT   -----  7
  pTask. . . . . . . . . . . . . . . .  MEMBER   -----  PTR      0000H  2
  Delay. . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0002H  2
  Period . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0004H  2
  RunMe. . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0006H  1
BULB_BLOWN . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
tByte. . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
SCH_tasks_G. . . . . . . . . . . . . .  EXTERN   DATA   ARRAY    -----  14
P0_0 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0080H  1
SCI_D_MASTER_Init_T2 . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
P1_0 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0090H  1
P0_1 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0081H  1
FL . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D1H  1
P2_0 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A0H  1
P1_1 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0091H  1
P0_2 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0082H  1
Interrupt_output_pin . . . . . . . . .  ABSBIT   -----  BIT      00A7H  1
tWord. . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
P3_0 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B0H  1
P2_1 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A1H  1
P1_2 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0092H  1
P0_3 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0083H  1
P3_1 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B1H  1
P2_2 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A2H  1
P1_3 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0093H  1
P0_4 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0084H  1
P3_2 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B2H  1
P2_3 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A3H  1
P1_4 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0094H  1
P0_5 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0085H  1
EXF2 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CEH  1
RD . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B7H  1
P3_3 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B3H  1
P2_4 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A4H  1
P1_5 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0095H  1
P0_6 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0086H  1
P3_4 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B4H  1
P2_5 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A5H  1
P1_6 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0096H  1
P0_7 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0087H  1
Red_light. . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A0H  1
P3_5 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B5H  1
ES . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00ACH  1
P2_6 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A6H  1
P1_7 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0097H  1
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 26  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


P3_6 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B6H  1
P2_7 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A7H  1
P3_7 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B7H  1
RI . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0098H  1
CY . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D7H  1
INT0 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B2H  1
INT1 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B3H  1
TI . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0099H  1
RCAP2H . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00CBH  1
PS . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BCH  1
T2EX . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0091H  1
RED_AMBER. . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
SCI_D_MASTER_Start . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
OV . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D2H  1
RCAP2L . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00CAH  1
C_T2 . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C9H  1
WR . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B6H  1
RCLK . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CDH  1
TCLK . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CCH  1
First_call_G . . . . . . . . . . . . .  PUBLIC   DATA   BIT      0000H  1
Error_code_G . . . . . . . . . . . . .  EXTERN   DATA   U_CHAR   -----  1
SCI_D_MASTER_Send_Tick_Message . . . .  STATIC   CODE   PROC     0000H  -----
IE0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0089H  1
IE1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008BH  1
CP_RL2 . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00C8H  1
eLight_State . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
ET0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A9H  1
_Hardware_Delay_T0 . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
ET1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00ABH  1
TF0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008DH  1
ET2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00ADH  1
TF1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008FH  1
TF2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CFH  1
RB8. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009AH  1
EX0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A8H  1
IT0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0088H  1
EX1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00AAH  1
TB8. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009BH  1
IT1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008AH  1
TH2. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00CDH  1
P. . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D0H  1
SM0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009FH  1
SM1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009EH  1
SM2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009DH  1
TL2. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00CCH  1
PT0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B9H  1
Watchdog_input_previous_G. . . . . . .  PUBLIC   DATA   BIT      0001H  1
RS0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D3H  1
PT1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BBH  1
RS1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D4H  1
PT2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BDH  1
TR0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008CH  1
TR1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008EH  1
TRAFFIC_LIGHTS_Display_Safe_Outp . . .  EXTERN   CODE   PROC     -----  -----
TR2. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CAH  1
PX0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B8H  1
PX1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00BAH  1
C51 COMPILER V6.10  SCI_DM                                                                 04/18/2001 16:48:12 PAGE 27  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


RED. . . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
Slave_watchdog_pin . . . . . . . . . .  ABSBIT   -----  BIT      00A6H  1
SCI_D_MASTER_Update_T2 . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  Index. . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
EXEN2. . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00CBH  1
Amber_light. . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A1H  1
REN. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009CH  1
T2MOD. . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C9H  1
T2CON. . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C8H  1
SCI_D_MASTER_Process_Ack . . . . . . .  STATIC   CODE   PROC     0000H  -----
AMBER. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
_SCH_Delete_Task . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
RXD. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B0H  1
Green_light. . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A2H  1
TXD. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B1H  1
GREEN. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
F0 . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00D5H  1
_?SCI_D_MASTER_Enter_Safe_State. . . .  PUBLIC   CODE   PROC     0000H  -----
Tick_message_data_G. . . . . . . . . .  PUBLIC   DATA   U_CHAR   0001H  1


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    287    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
